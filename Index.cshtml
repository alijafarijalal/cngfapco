@model IEnumerable<cngfapco.Models.Financial>

@{
    ViewBag.Title = "Financial Index";
    Layout = "~/Views/Shared/_DataTableLayout.cshtml";
    string fromDate = (string)ViewBag.fromDate;
    string toDate = (string)ViewBag.toDate;
    int? workshop = (int?)ViewBag.workshop;
    bool? Post = (bool?)ViewBag.Post;
    List<cngfapco.Models.Role> rolName = cngfapco.Helper.Helpers.GetCurrentUserRoles();
}

<script src="~/js/admin/jquery-1.10.2.js"></script>

<script type="text/javascript">
    //
    function printtag(tagid) {
        var hashid = "#" + tagid;
        var tagname = $(hashid).prop("tagName").toLowerCase();
        var attributes = "";
        var attrs = document.getElementById(tagid).attributes;
        $.each(attrs, function (i, elem) {
            attributes += " " + elem.name + " ='" + elem.value + "' ";
        })
        var divToPrint = $(hashid).html();
        var head = "<html><head>" + $("head").html() + "</head>";
        var allcontent = head + "<body  dir='rtl' onload='window.print()' style='background-color:#ffffff'>" + "<" + tagname + attributes + ">" + divToPrint + "</" + tagname + ">" + "</body></html>";
        var newWin = window.open('', 'Print-Window');
        newWin.document.open();
        newWin.document.write(allcontent);
        newWin.document.close();
        setTimeout(function () { newWin.close(); }, 10000);
    }


/**/</script>
<!-- BEGIN PAGE HEADER-->
<div class="row-fluid">
    <div class="span12">
        <!-- BEGIN PAGE TITLE & BREADCRUMB-->
        <ul class="breadcrumb">
            <li>
                <a href="/Home/Index"><i class="icon-home"></i></a><span class="divider">&nbsp;</span>
            </li>
            <li>
                <a href=""> مدیریت مالی </a> <span class="divider-last">&nbsp;</span>
            </li>
        </ul>
        <!-- END PAGE TITLE & BREADCRUMB-->
    </div>
</div>
<!-- END PAGE HEADER-->

<div class="widget">

    <div class="widget-title">
        <h4><i class="icon-money"></i>مبالغ به ریال</h4>
        <span class="tools">
            <a href="javascript:;" class="icon-chevron-down"></a>
            <a href="javascript:;" class="icon-remove"></a>
        </span>
        <div class="actions">
            <a onclick='printtag("DivIdToPrint")' class=""> <i class="btn icon-print" style="color:#000000;font-size:20px;"></i> </a>
        </div>
    </div>

    <div class="widget-body">

        @using (Html.BeginForm())
        {
            @Html.Hidden("Post", true)
            <div class="row-fluid">
                <div class="span4">
                    <label class="control-label" for="inputWarning">کارگاه/ شرکت</label>
                    @Html.DropDownList("WorkshopID", null, "همه", htmlAttributes: new { @class = "chosen span10", @id = "inputWarning" })@*, @multiple = "multiple" , @onchange="submit();"*@
                </div>
                <div class="span3">
                    <label class="control-label" for="inputWarning">از تاریخ </label>
                    <input class="pdate" id="pcal1" name="fromDate" value="@fromDate" />
                </div>
                <div class="span3">
                    <label class="control-label" for="inputWarning">تا تاریخ </label>
                    <input class="pdate" id="pcal2" name="toDate" value="@toDate" />
                </div>
                <div class="span2">
                    <label class="control-label" for="inputWarning">فیلتر </label>
                    <button type="submit" value="" class="icon-filter"></button>
                </div>
            </div>
        }

        <div id="TopSection"></div>
    </div>

</div>
<div class="space10"></div>

<div class="row-fluid">
    <div class="widget">
        <div class="widget-title">
            <h4><i class="icon-reorder"></i>جدول خلاصه وضعیت عملکرد مالی کارگاه</h4>
            <span class="tools">
                <a href="javascript:;" class="icon-chevron-down"></a>
                <a href="javascript:;" class="icon-remove"></a>
            </span>
        </div>
        <div class="widget-body form">
            <div>
                @foreach (var item in rolName)
                {
                    if (item.RoleName.Contains("مدیر تبدیل ناوگان") || item.RoleName.Equals("admin"))
                    {
                        <span>
                            <span class="text-warning">  آخرین دستور پرداخت </span>
                            <span> ( </span>
                            <span> <i class="icon-barcode icon-white text-warning"></i> </span>
                            <strong dir="rtl">
                                <a href="/Financials/EditOfferedPrice?number=@ViewBag.number">
                                    @ViewBag.existOfferedSerial
                                </a>
                            </strong>
                            <span style="margin-right:10px;"> <i class="icon-calendar icon-white text-warning"></i></span>
                            <strong> @ViewBag.existOfferedDate </strong> <span> )</span>
                        </span>

                        <span class="actions" style="padding-right:2em;">
                            <a href="/Financials/OfferedPrice?fromDate=@fromDate&toDate=@toDate"> <i class="btn icon-edit"></i> دستور پرداخت علی الحساب </a>
                            <a onclick='printtag("DivIdToPrint3")' class=""> <i class="btn icon-print" style="color:#000000;font-size:20px;"></i> </a>
                        </span>
                    }
                }
            </div>
            <div id="AnalyseTableSection">
            </div>
        </div>
    </div>
</div>

<div class="space10"></div>

@try
{
    <div class="row-fluid">
        <div class="widget">
            <div class="widget-title">
                <h4><i class="icon-reorder"></i>مقایسه اطلاعات صورتحساب‌های صادر شده و دستمزد تبدیل </h4>
                <span class="tools">
                    <a href="javascript:;" class="icon-chevron-down"></a>
                    <a href="javascript:;" class="icon-remove"></a>
                </span>
            </div>
            <div class="widget-body form">
                <div style="overflow:auto;" id="">
                    @Html.Action("InvoiceFapaDiffWithSalary", new { WorkshopID = workshop, fromDate = fromDate, toDate = toDate })
                </div>
                <div style="overflow:auto;" id="">
                    @Html.Action("InvoiceFapaDiffWithRegisterCount", new { WorkshopID = workshop, fromDate = fromDate, toDate = toDate })
                </div>
            </div>
        </div>
    </div>
}
catch
{
    <div class="row-fluid">
        <div style="overflow:auto;">
            <center>
                <span class="text-danger">اطلاعاتی برای نمایش یافت نشد!</span>
            </center>
        </div>
    </div>
}

@*<div id="DetailsSection"></div>*@


<script>
    $(document).ready(function () {
        $.get('/Financials/TopSection?WorkshopID=@workshop&fromDate=@fromDate&toDate=@toDate&Post=@Post', function (data) {
            $('#TopSection').html(data);
        });

        $.get('/Financials/AnalyseTableSection?WorkshopID=@workshop&fromDate=@fromDate&toDate=@toDate&Post=@Post', function(data) {
            $('#AnalyseTableSection').html(data);
        });
    });
</script>